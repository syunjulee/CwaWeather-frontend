<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>é˜¿è«åª½åª½çš„å¤©æ°£å°åŠ©æ‰‹</title>

  <!-- å…¨éƒ¨æ”¹ç”¨ v1 åœ–ç¤º -->
  <link rel="icon" type="image/png" href="./icon-v1.png">
  <link rel="apple-touch-icon" href="./icon-v1.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./icon-v1.png">

  <!-- å­—é«” -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=Press+Start+2P&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --ac-bg-main: #FCD5B5;
      --ac-bg-alt: #FBE4C8;
      --ac-cream: #FFF7E6;
      --ac-orange: #FFA45B;
      --ac-orange-dark: #F78B3D;
      --ac-red: #EF6F6C;
      --ac-yellow: #FFE48F;
      --ac-brown: #6B4F3F;
      --ac-dark: #3A2C25;
      --ac-card-border: #E0B394;
      --ac-pixel-shadow: #C58C63;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Zen Maru Gothic', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--ac-bg-main);
      background-image:
        linear-gradient(to right, rgba(255, 255, 255, 0.25) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.25) 1px, transparent 1px);
      background-size: 16px 16px;
      min-height: 100vh;
      color: var(--ac-dark);
      overflow-x: hidden;
      padding-bottom: 20px;
    }

    .pixel-font {
      font-family: 'Press Start 2P', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      letter-spacing: 0.04em;
    }

    /* é ‚éƒ¨ç‹€æ…‹åˆ— */
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: var(--ac-orange);
      border-bottom: 4px solid #000;
      box-shadow:
        0 4px 0 #000,
        0 6px 0 var(--ac-pixel-shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .location-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--ac-yellow);
      color: var(--ac-brown);
      padding: 6px 12px;
      border-radius: 4px;
      border: 3px solid #000;
      box-shadow: 0 3px 0 #000;
      font-weight: 900;
      font-size: 0.9rem;
    }

    .update-pill {
      font-size: 0.6rem;
      color: #000;
      background: var(--ac-cream);
      padding: 4px 8px;
      border-radius: 4px;
      border: 3px solid #000;
      box-shadow: 0 3px 0 #000;
      font-weight: 700;
    }

    .container {
      padding: 18px 16px 24px;
      max-width: 600px;
      margin: 0 auto;
    }

    /* RWD ä½ˆå±€å®¹å™¨ï¼ˆæ‰‹æ©Ÿé è¨­å–®æ¬„ï¼‰ */
    .layout-grid {
      display: block;
    }

    /* Hero å¡ç‰‡ */
    .hero-card {
      background: var(--ac-cream);
      border-radius: 8px;
      padding: 26px 20px 22px;
      text-align: center;
      border: 4px solid #000;
      box-shadow:
        0 4px 0 #000,
        0 8px 0 var(--ac-pixel-shadow);
      margin-bottom: 18px;
      position: relative;
    }

    .hero-period {
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--ac-red);
      color: #FFF7E6;
      padding: 6px 16px;
      border-radius: 4px;
      border: 4px solid #000;
      box-shadow: 0 4px 0 #000;
      font-weight: 900;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    .hero-temp-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin: 18px 0 10px;
    }

    .hero-icon {
      font-size: 4.5rem;
      filter: drop-shadow(0 3px 0 rgba(0, 0, 0, 0.3));
      animation: bounce 3s infinite steps(2);
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-8px);
      }
    }

    .hero-temp {
      font-size: 3.4rem;
      font-weight: 900;
      color: var(--ac-brown);
      line-height: 1;
    }

    .hero-temp .pixel-font {
      font-size: 2.8rem;
    }

    .hero-desc {
      font-size: 1.2rem;
      color: #8A6A55;
      margin-bottom: 12px;
      font-weight: bold;
    }

    /* å»ºè­°å€ */
    .advice-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 16px;
      padding-top: 14px;
      border-top: 3px dashed #E0B394;
    }

    .advice-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--ac-bg-alt);
      padding: 10px 8px;
      border-radius: 6px;
      border: 3px solid #000;
      box-shadow: 0 3px 0 #000;
    }

    .advice-icon {
      font-size: 1.8rem;
      margin-bottom: 4px;
    }

    .advice-text {
      font-size: 0.95rem;
      font-weight: 900;
      color: var(--ac-brown);
      margin: 4px 0;
      line-height: 1.3;
      text-align: center;
    }

    .advice-item-sub {
      font-size: 0.7rem;
      color: #5B4A40;
      margin-top: 2px;
    }

    /* é˜¿è«åª½åª½ NPC å€å¡Š */
    .npc-wrapper {
      margin-top: 16px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .npc-avatar-frame {
      width: 64px;
      height: 64px;
      background: var(--ac-bg-alt);
      border-radius: 4px;
      border: 4px solid #000;
      box-shadow: 0 4px 0 #000;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .npc-avatar-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      image-rendering: pixelated;
      border-radius: 2px;
    }

    .npc-dialog {
      flex: 1;
      position: relative;
      background: var(--ac-bg-alt);
      border-radius: 6px;
      border: 4px solid #000;
      box-shadow: 0 4px 0 #000;
      padding: 8px 10px 10px;
    }

    .npc-name-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      background: var(--ac-red);
      color: #FFF7E6;
      border-radius: 4px;
      border: 3px solid #000;
      box-shadow: 0 3px 0 #000;
      font-size: 0.7rem;
      font-weight: 900;
      margin-bottom: 4px;
    }

    .npc-name-tag .pixel-font {
      font-size: 0.6rem;
    }

    .npc-text {
      font-size: 0.9rem;
      color: #3A2C25;
      line-height: 1.4;
      margin-top: 4px;
    }

    .npc-dialog::before {
      content: "";
      position: absolute;
      left: -10px;
      top: 18px;
      width: 0;
      height: 0;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      border-right: 10px solid #000;
    }

    .npc-dialog::after {
      content: "";
      position: absolute;
      left: -7px;
      top: 20px;
      width: 0;
      height: 0;
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
      border-right: 7px solid var(--ac-bg-alt);
    }

    /* ç¨å¾Œé å ±å€å¡Š */
    .future-section {
      margin-top: 18px;
    }

    .section-title {
      font-size: 0.8rem;
      margin-bottom: 10px;
      margin-left: 4px;
      font-weight: 900;
      color: #000;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: var(--ac-orange-dark);
      border-radius: 4px;
      border: 3px solid #000;
      box-shadow: 0 3px 0 #000;
    }

    .section-title span {
      font-size: 0.7rem;
    }

    .scroll-container {
      display: flex;
      overflow-x: auto;
      gap: 12px;
      padding: 4px 2px 10px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .scroll-container::-webkit-scrollbar {
      display: none;
    }

    .mini-card {
      min-width: 120px;
      background: var(--ac-cream);
      border-radius: 6px;
      padding: 14px 10px;
      text-align: center;
      border: 3px solid #000;
      box-shadow: 0 3px 0 #000;
      flex-shrink: 0;
    }

    .mini-time {
      display: inline-block;
      background: var(--ac-yellow);
      color: #000;
      padding: 4px 6px;
      border-radius: 4px;
      border: 2px solid #000;
      font-size: 0.65rem;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .mini-icon {
      font-size: 2.1rem;
      margin: 4px 0;
      filter: drop-shadow(0 2px 0 rgba(0, 0, 0, 0.25));
    }

    .mini-temp {
      font-size: 0.95rem;
      font-weight: 800;
      color: var(--ac-dark);
      margin-top: 2px;
    }

    .mini-rain {
      font-size: 0.7rem;
      color: #5B4A40;
      margin-top: 4px;
    }

    /* Loading ç•«é¢ */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--ac-bg-main);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .loading-icon {
      font-size: 4rem;
      animation: bounce 2s infinite steps(2);
      text-shadow: 0 3px 0 rgba(0, 0, 0, 0.3);
    }

    .loading-text {
      color: #000;
      font-weight: bold;
      margin-top: 18px;
      padding: 6px 10px;
      background: var(--ac-cream);
      border-radius: 4px;
      border: 3px solid #000;
      box-shadow: 0 3px 0 #000;
      font-size: 0.8rem;
    }

    /* =========================
       RWD æ–·é»ï¼š414 / 768 / 1440
       ========================= */

    /* 414 ä»¥ä¸Šï¼šç¨å¾®åŠ å¯¬ã€å­—ç´šå¾®èª¿ */
    @media (min-width: 414px) {
      .container {
        padding: 20px 20px 28px;
        max-width: 640px;
      }

      .hero-temp {
        font-size: 3.6rem;
      }

      .hero-temp .pixel-font {
        font-size: 3rem;
      }

      .mini-card {
        min-width: 130px;
      }
    }

    /* 768 ä»¥ä¸Šï¼šå¹³æ¿èˆ‡å°æ¡Œæ©Ÿï¼Œå…©æ¬„ç‰ˆé¢ */
    @media (min-width: 768px) {
      .container {
        max-width: 960px;
        padding: 24px 32px 36px;
      }

      .layout-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.25fr) minmax(0, 1fr);
        align-items: flex-start;
        gap: 24px;
      }

      .hero-card {
        margin-bottom: 0;
      }

      .future-section {
        margin-top: 0;
      }

      .section-title {
        margin-left: 0;
      }

      .hero-temp {
        font-size: 3.8rem;
      }

      .hero-temp .pixel-font {
        font-size: 3.2rem;
      }

      .hero-desc {
        font-size: 1.3rem;
      }

      .mini-card {
        min-width: 140px;
      }
    }

    /* 1440 ä»¥ä¸Šï¼šå¤§æ¡Œæ©Ÿï¼Œç‰ˆé¢æ›´å¯¬ã€é–“è·æ›´èˆ’æœ */
    @media (min-width: 1440px) {
      .container {
        max-width: 1120px;
        padding: 28px 40px 40px;
      }

      .layout-grid {
        gap: 32px;
      }

      .hero-card {
        padding: 30px 26px 26px;
      }

      .hero-temp {
        font-size: 4.2rem;
      }

      .hero-temp .pixel-font {
        font-size: 3.4rem;
      }

      .mini-card {
        min-width: 150px;
        padding: 16px 12px;
      }
    }
  </style>
</head>

<body>
  <div id="loading" class="loading-screen">
    <div class="loading-icon">â˜ï¸</div>
    <p class="loading-text">ç¨ç­‰æˆ‘é–‹é–‹...</p>
  </div>

  <div class="status-bar">
    <div class="location-pill">ğŸ“ æ–°åŒ—å¸‚</div>
    <div id="updateTime" class="update-pill pixel-font"></div>
  </div>

  <div class="container" id="mainContent" style="display: none;">

    <!-- æ–°å¢ layout-gridï¼Œè®“æ¡Œæ©Ÿ/å¹³æ¿å¯ä»¥å…©æ¬„æ’ç‰ˆ -->
    <div class="layout-grid">
      <div id="heroCard"></div>

      <div class="future-section">
        <h3 class="section-title">
          <span class="pixel-font">NEXT</span>
          <span>ç¨å¾Œé å ±</span>
        </h3>
        <div class="scroll-container" id="futureForecasts"></div>
      </div>
    </div>

  </div>

  <script>
    const API_URL = "https://weather-newtaipeicity.zeabur.app/api/weather/kaohsiung";

    function getWeatherIcon(weather) {
      if (!weather) return "ğŸŒ¤ï¸";
      if (weather.includes("æ™´")) return "â˜€ï¸";
      if (weather.includes("å¤šé›²")) return "â›…";
      if (weather.includes("é™°")) return "â˜ï¸";
      if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
      if (weather.includes("é›·")) return "â›ˆï¸";
      return "ğŸŒ¤ï¸";
    }

    function getAdvice(rainProb, maxTemp) {
      let rainIcon = "ğŸŒ‚";
      let rainText = "å‚˜æ”¾å®¶å°±å¥½";
      if (parseInt(rainProb) > 30) {
        rainIcon = "â˜‚ï¸";
        rainText = "è¨˜å¾—å¸¶å‚˜å’Œç©¿é˜²æ°´é‹ï¼";
      }

      let clothIcon = "ğŸ‘•";
      let clothText = "ç©¿èˆ’æœå°±å¥½";
      if (parseInt(maxTemp) >= 28) {
        clothIcon = "ğŸ½";
        clothText = "é€™æœƒç†±å–”";
      } else if (parseInt(maxTemp) <= 20) {
        clothIcon = "ğŸ§¥";
        clothText = "å¸¶ä»¶å¤–å¥—";
      }

      return { rainIcon, rainText, clothIcon, clothText };
    }

    function getNpcMessage(current) {
      const rain = parseInt(current.rain);
      const maxTemp = parseInt(current.maxTemp || current.minTemp || 0);
      const weather = current.weather || "";

      if (rain >= 70) {
        return "ä»Šå¤©é›¨è »å¤§çš„ï¼Œå‡ºé–€ä¸€å®šè¦å¸¶å¥½é›¨å…·ï¼Œè·¯ä¸Šæ…¢æ…¢èµ°ä¸è¦è¶•ã€‚";
      }
      if (maxTemp >= 32) {
        return "ä»Šå¤©å¾ˆæ‚¶ç†±ï¼Œè¨˜å¾—å¤šè£œå……æ°´åˆ†ï¼Œå¤–å‡ºèƒ½èµ°é™°å½±å°±èµ°é™°å½±ã€‚";
      }
      if (maxTemp <= 16) {
        return "ä»Šå¤©æ¯”è¼ƒæ¶¼ï¼Œå‡ºé–€å‰åŠ ä¸€ä»¶å¤–å¥—ï¼Œä¸è¦è®“è‡ªå·±è‘—æ¶¼ã€‚";
      }
      if (rain >= 40) {
        return "å¯èƒ½æœƒä¸‹é›¨ï¼ŒåŒ…åŒ…æ”¾æŠŠæ‘ºç–Šå‚˜ï¼Œæ¯”è¼ƒå®‰å¿ƒã€‚";
      }
      if (weather.includes("é™°")) {
        return "ä»Šå¤©å¤©è‰²åé™°ï¼Œé¨è»Šé–‹è»Šéƒ½æ”¾æ…¢ä¸€é»ï¼Œçœ‹æ¸…æ¥šå†è½‰å½ã€‚";
      }
      if (weather.includes("æ™´")) {
        return "ä»Šå¤©å¤©æ°£ä¸éŒ¯ï¼Œè¨˜å¾—å¸¶ä¸€ç“¶æ°´åœ¨åŒ…åŒ…è£¡ï¼Œéš¨æ™‚è£œå……ã€‚";
      }
      return "ä»Šå¤©å‡ºé–€å‰ï¼Œç°¡å–®çœ‹ä¸€ä¸‹å¤©æ°£è®ŠåŒ–ï¼Œæœ‰éœ€è¦å°±å¤šå¸¶ä¸€æ¨£é˜²è­·çš„æ±è¥¿ã€‚";
    }

    function getTimePeriod(startTime) {
      const hour = new Date(startTime).getHours();
      if (hour >= 5 && hour < 11) return "æ—©æ™¨";
      if (hour >= 11 && hour < 14) return "ä¸­åˆ";
      if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
      if (hour >= 18 && hour < 23) return "æ™šä¸Š";
      return "æ·±å¤œ";
    }

    function renderWeather(data) {
      const forecasts = data.forecasts;
      const current = forecasts[0];
      const others = forecasts.slice(1);

      const advice = getAdvice(current.rain, current.maxTemp);
      const period = getTimePeriod(current.startTime);
      const avgTemp = Math.round(
        (parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2
      );
      const npcMessage = getNpcMessage(current);

      document.getElementById('heroCard').innerHTML = `
        <div class="hero-card">
          <div class="hero-period pixel-font">${period}</div>
          <div class="hero-temp-container">
            <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
            <div class="hero-temp">
              <span class="pixel-font">${avgTemp}Â°</span>
            </div>
          </div>
          <div class="hero-desc">${current.weather}</div>

          <div class="advice-grid">
            <div class="advice-item">
              <div class="advice-icon">${advice.rainIcon}</div>
              <div class="advice-text">${advice.rainText}</div>
              <div class="advice-item-sub">é™é›¨ç‡ ${current.rain}</div>
            </div>
            <div class="advice-item">
              <div class="advice-icon">${advice.clothIcon}</div>
              <div class="advice-text">${advice.clothText}</div>
              <div class="advice-item-sub">æœ€é«˜æº« ${current.maxTemp}Â°</div>
            </div>
          </div>

          <div class="npc-wrapper">
            <div class="npc-avatar-frame">
              <img src="./icon-v1.png" alt="é˜¿è«åª½åª½" class="npc-avatar-img">
            </div>
            <div class="npc-dialog">
              <div class="npc-name-tag">
                <span class="pixel-font">NPC</span>
                <span>é˜¿è«åª½åª½</span>
              </div>
              <div class="npc-text">${npcMessage}</div>
            </div>
          </div>
        </div>
      `;

      const scrollContainer = document.getElementById('futureForecasts');
      scrollContainer.innerHTML = '';

      const todayDate = new Date().getDate();

      others.forEach(f => {
        let p = getTimePeriod(f.startTime);
        const fDate = new Date(f.startTime);
        if (fDate.getDate() !== todayDate) {
          p = "æ˜å¤©" + p;
        }

        scrollContainer.innerHTML += `
          <div class="mini-card">
            <div class="mini-time pixel-font">${p}</div>
            <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
            <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
            <div class="mini-rain">ğŸ’§${f.rain}</div>
          </div>
        `;
      });

      const now = new Date();
      const month = now.getMonth() + 1;
      const date = now.getDate();
      const dayIndex = now.getDay();
      const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];

      document.getElementById('updateTime').textContent =
        `${month}/${date} ${days[dayIndex]}`;
    }

    async function fetchWeather() {
      try {
        const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
        const fetchPromise = fetch(API_URL).then(res => res.json());
        const [_, json] = await Promise.all([delayPromise, fetchPromise]);

        if (json.success) {
          renderWeather(json.data);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('mainContent').style.display = 'block';
        } else {
          throw new Error("API Error");
        }
      } catch (e) {
        console.error(e);
        alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œè¶•å¿«å‘Šè¨´å§Šå§Šï¼");
      }
    }

    document.addEventListener("DOMContentLoaded", fetchWeather);
  </script>
</body>

</html>